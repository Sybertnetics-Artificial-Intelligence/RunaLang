Note: TestTypeDefinition

Process called "extract_token_part" that takes token_data as String, part_index as Integer returns String:
    Note: ExtractTokenPart
    Let current_part be 0
    Let start_pos be 0
    Let i be 0
    Let token_length be length_of(token_data)

    While i is less than token_length:
        Let char_code be char_at(token_data, i)
        If char_code is equal to 124:
            If current_part is equal to part_index:
                Return substring(token_data, start_pos, i)
            End If
            Set current_part to current_part plus 1
            Set start_pos to i plus 1
        End If
        Set i to i plus 1
    End While

    If current_part is equal to part_index:
        Return substring(token_data, start_pos, token_length)
    End If
    Return ""
End Process

Process called "get_token_at_position" that takes tokens as String, position as Integer returns String:
    Note: ExtractToken
    Let line_start be 0
    Let current_line be 0
    Let i be 0
    Let tokens_length be length_of(tokens)

    While i is less than tokens_length:
        Let char_code be char_at(tokens, i)
        If char_code is equal to 10:
            If current_line is equal to position:
                Return substring(tokens, line_start, i)
            End If
            Set current_line to current_line plus 1
            Set line_start to i plus 1
        End If
        Set i to i plus 1
    End While

    If current_line is equal to position:
        Return substring(tokens, line_start, tokens_length)
    End If
    Return "EOF|end|0|0"
End Process

Process called "parse_type_definition" that takes tokens as String, position as Integer returns String:
    Note: ParseTypeDefinition
    Let name_token be get_token_at_position(tokens, position plus 2)
    Let type_name be extract_token_part(name_token, 1)
    Let result be "type_definition|"
    Set result to concat(result, type_name)
    Set result to concat(result, "|fields")
    Return result
End Process

Process called "test_main":
    Note: TestTypeDefinitionFunction
    Let mock_tokens be "Type|Type|1|1\nCalled|called|1|6\nUser|User|1|13"
    Let result be parse_type_definition(mock_tokens, 0)
End Process