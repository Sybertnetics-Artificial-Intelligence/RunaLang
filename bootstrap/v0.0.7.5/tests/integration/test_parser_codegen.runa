Process called "test_simple_codegen" returns Integer:
    Let source be "Process called \"test\" returns Integer:\n    Return 42\nEnd Process"

    Let lexer be lexer_create(source)
    Let parser be parser_create(lexer)
    Let program be parser_parse_program(parser)

    Let codegen be codegen_create("test_output.s")
    codegen_generate(codegen, program)
    codegen_destroy(codegen)

    # Verify assembly file contains expected content
    Let assembly be read_file("test_output.s")
    Let has_main be string_find(assembly, "test:")
    assert(has_main is not equal to -1)

    Let has_return be string_find(assembly, "movq $42, %rax")
    assert(has_return is not equal to -1)

    program_destroy(program)
    parser_destroy(parser)
    lexer_destroy(lexer)
    Return 0
End Process