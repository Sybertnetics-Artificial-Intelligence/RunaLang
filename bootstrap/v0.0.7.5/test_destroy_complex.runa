# Test case for destroy function issue with multiple branches

Let EXPR_TYPE be 0
Let EXPR_BINARY be 1
Let EXPR_UNARY be 2
Let EXPR_CALL be 3
Let EXPR_FIELD_ACCESS be 4
Let EXPR_ARRAY_ACCESS be 5
Let EXPR_IDENTIFIER be 6
Let EXPR_STRING_LITERAL be 7
Let EXPR_BINARY_LEFT be 8
Let EXPR_BINARY_RIGHT be 16
Let EXPR_UNARY_OPERAND be 8
Let EXPR_CALL_NAME be 8
Let EXPR_FIELD_OBJECT be 8
Let EXPR_FIELD_NAME be 16
Let EXPR_ARRAY_OBJECT be 8
Let EXPR_ARRAY_INDEX_OFFSET be 16
Let EXPR_IDENTIFIER_NAME be 8
Let EXPR_STRING_VALUE be 8

Process called "memory_get_integer" takes ptr as Integer, offset as Integer returns Integer:
    Return 0
End Process

Process called "memory_get_pointer" takes ptr as Integer, offset as Integer returns Integer:
    Return 0
End Process

Process called "deallocate" takes ptr as Integer returns Integer:
    Return 0
End Process

Process called "string_destroy" takes str as Integer returns Integer:
    Return 0
End Process

Process called "expression_destroy" takes expr as Integer returns Integer:
    If expr is equal to 0:
        Return 0
    End If

    Let expr_type be memory_get_integer(expr, EXPR_TYPE)

    If expr_type is equal to EXPR_BINARY:
        expression_destroy(memory_get_pointer(expr, EXPR_BINARY_LEFT))
        expression_destroy(memory_get_pointer(expr, EXPR_BINARY_RIGHT))
    Otherwise If expr_type is equal to EXPR_UNARY:
        expression_destroy(memory_get_pointer(expr, EXPR_UNARY_OPERAND))
    Otherwise If expr_type is equal to EXPR_CALL:
        string_destroy(memory_get_pointer(expr, EXPR_CALL_NAME))
    Otherwise If expr_type is equal to EXPR_FIELD_ACCESS:
        expression_destroy(memory_get_pointer(expr, EXPR_FIELD_OBJECT))
        string_destroy(memory_get_pointer(expr, EXPR_FIELD_NAME))
    Otherwise If expr_type is equal to EXPR_ARRAY_ACCESS:
        expression_destroy(memory_get_pointer(expr, EXPR_ARRAY_OBJECT))
        expression_destroy(memory_get_pointer(expr, EXPR_ARRAY_INDEX_OFFSET))
    Otherwise If expr_type is equal to EXPR_IDENTIFIER:
        string_destroy(memory_get_pointer(expr, EXPR_IDENTIFIER_NAME))
    Otherwise If expr_type is equal to EXPR_STRING_LITERAL:
        string_destroy(memory_get_pointer(expr, EXPR_STRING_VALUE))
    End If

    deallocate(expr)
    Return 0
End Process

Process called "main" takes argc as Integer, argv as Integer returns Integer:
    Return 0
End Process