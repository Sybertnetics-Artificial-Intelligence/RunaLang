Note: Comprehensive Pattern Matching Test - Phases 6-9
Note: Tests variant pattern matching with proper discriminator checks
Note: This is the critical test that failed before the bug fix

Type Result is:
    | Success
    | Failure
End Type

Type Pair is:
    | First
    | Second
End Type

Type Triple is:
    | One
    | Two
    | Three
End Type

Process called "main" returns Integer:
    Note: Phase 6-7: Literal pattern matching
    Let x be 42
    Match x:
        When 0:
            Display "FAIL: Matched 0 instead of 42"
            Return 1
        When 42:
            Note: Correct
        When 100:
            Display "FAIL: Matched 100 instead of 42"
            Return 1
    End Match

    Note: Phase 8-9: Variant pattern matching (two variants)
    Let f be Pair as First
    Match f:
        When First:
            Note: Correct - First matched First
        When Second:
            Display "FAIL: First matched Second pattern"
            Return 1
    End Match

    Let s be Pair as Second
    Match s:
        When First:
            Display "FAIL: Second matched First pattern"
            Return 1
        When Second:
            Note: Correct - Second matched Second
    End Match

    Note: Critical test: Three variants (tests tags 0, 1, 2)
    Let one be Triple as One
    Let two be Triple as Two
    Let three be Triple as Three

    Match one:
        When One:
            Note: Correct
        When Two:
            Display "FAIL: One matched Two"
            Return 1
        When Three:
            Display "FAIL: One matched Three"
            Return 1
    End Match

    Match two:
        When One:
            Display "FAIL: Two matched One"
            Return 1
        When Two:
            Note: Correct
        When Three:
            Display "FAIL: Two matched Three"
            Return 1
    End Match

    Match three:
        When One:
            Display "FAIL: Three matched One"
            Return 1
        When Two:
            Display "FAIL: Three matched Two"
            Return 1
        When Three:
            Note: Correct
    End Match

    Note: All pattern matches succeeded
    Return 0
End Process
